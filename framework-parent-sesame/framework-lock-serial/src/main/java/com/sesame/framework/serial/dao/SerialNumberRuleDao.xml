<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sesame.framework.serial.dao.SerialNumberRuleDao">

    <sql id="fieldSelect">
 		code code,name name,cur_time curTime,cur_num curNum
 	</sql>

    <update id="check_notExistsCreate">
        CREATE TABLE  IF NOT EXISTS `sys_serial_number_rule` (
          `code` VARCHAR(50) NOT NULL COMMENT '编码',
          `name` VARCHAR(400) NOT NULL COMMENT '名称',
          `cur_time` DATETIME NOT NULL COMMENT '当前时间',
          `cur_num` DECIMAL(18,0) NOT NULL COMMENT '当前序号',
          PRIMARY KEY (`code`)
        ) ENGINE=INNODB DEFAULT CHARSET=utf8 COMMENT='序列号表'
    </update>

    <select id="querySerialNumberRuleForUpdate" resultType="com.sesame.framework.serial.entity.SerialNumberRuleEntity"
            parameterType="string">
        SELECT
        <include refid="fieldSelect"/>
        FROM sys_serial_number_rule
        WHERE CODE = #{code} FOR UPDATE
    </select>
    <insert id="addSerialNumberRule" parameterType="com.sesame.framework.serial.entity.SerialNumberRuleEntity">
        INSERT INTO sys_serial_number_rule
        (
        <trim suffixOverrides=",">
            <if test="code != null and code != ''">code,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="curTime != null">cur_time,</if>
            <if test="curNum != null">cur_num,</if>
        </trim>
        )VALUES(
        <trim suffixOverrides=",">
            <if test="code != null and code != ''">#{code},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="curTime != null">#{curTime},</if>
            <if test="curNum != null">#{curNum},</if>
        </trim>
        )
    </insert>
    <update id="updateSerialNumberRule" parameterType="com.sesame.framework.serial.entity.SerialNumberRuleEntity">
        UPDATE sys_serial_number_rule
        SET
        cur_time = #{curTime},
        cur_num = #{curNum}
        WHERE CODE = #{code}
    </update>

</mapper>